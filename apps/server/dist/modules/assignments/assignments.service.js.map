{"version":3,"sources":["../../../src/modules/assignments/assignments.service.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\nimport { CreateAssignmentDto } from './dto/create-assignment.dto';\nimport { UpdateAssignmentDto } from './dto/update-assignment.dto';\nimport { DatabaseService } from '@common/database/database.service';\nimport { assignments, assignmentsGroups, assignmentsQuestions } from './entities/assignment.entity';\nimport { and, eq } from 'drizzle-orm';\n\n@Injectable()\nexport class AssignmentsService {\n  constructor(private readonly drizzle: DatabaseService) { }\n\n  async create(createAssignmentDto: CreateAssignmentDto, userId: string) {\n    const assignment = await this.drizzle.db.insert(assignments).values({ ...createAssignmentDto, userId }).returning()[0];\n    await this.drizzle.db.insert(assignmentsGroups).values(createAssignmentDto.groups.map(g => ({ assignmentId: assignment.id, groupId: g.groupId })));\n    await this.drizzle.db.insert(assignmentsQuestions).values(createAssignmentDto.questions.map(q => ({ assignmentId: assignment.id, questionId: q.questionId })));\n    return assignment;\n  }\n\n  async findAll() {\n    return this.drizzle.db.select().from(assignments);\n  }\n\n  async findOne(id: number) {\n    return this.drizzle.db.select().from(assignments).where(eq(assignments.id, id));\n  }\n\n  async delete(id: number) {\n    return this.drizzle.db.delete(assignments).where(eq(assignments.id, id)).returning();\n  }\n\n  async update(id: number, updateAssignmentDto: UpdateAssignmentDto) {\n    return this.drizzle.db.update(assignments).set(updateAssignmentDto).where(eq(assignments.id, id)).returning();\n  }\n\n  async addQuestionToAssignment(id: number, questionId: number) {\n    return this.drizzle.db.insert(assignmentsQuestions).values({ assignmentId: id, questionId }).returning();\n  }\n\n  async addGroupToAssignment(id: number, groupId: number) {\n    return this.drizzle.db.insert(assignmentsGroups).values({ assignmentId: id, groupId }).returning();\n  }\n\n  async removeQuestionFromAssignment(id: number, questionId: number) {\n    return this.drizzle.db.delete(assignmentsQuestions).where(and(eq(assignmentsQuestions.assignmentId, id), eq(assignmentsQuestions.questionId, questionId))).returning();\n  }\n\n  async removeGroupFromAssignment(id: number, groupId: number) {\n    return this.drizzle.db.delete(assignmentsGroups).where(and(eq(assignmentsGroups.assignmentId, id), eq(assignmentsGroups.groupId, groupId))).returning();\n  }\n}\n"],"names":["AssignmentsService","create","createAssignmentDto","userId","assignment","drizzle","db","insert","assignments","values","returning","assignmentsGroups","groups","map","g","assignmentId","id","groupId","assignmentsQuestions","questions","q","questionId","findAll","select","from","findOne","where","eq","delete","update","updateAssignmentDto","set","addQuestionToAssignment","addGroupToAssignment","removeQuestionFromAssignment","and","removeGroupFromAssignment","constructor"],"mappings":"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"}