{"version":3,"sources":["../src/main.ts"],"sourcesContent":["import { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { EnvService } from '@common/env/env.service';\nimport { Logger, ValidationPipe } from '@nestjs/common';\nimport { SwaggerModule, DocumentBuilder } from '@nestjs/swagger';\nimport { FastifyAdapter, NestFastifyApplication } from '@nestjs/platform-fastify';\nimport * as  compression from '@fastify/compress';\nimport * as  cookie from '@fastify/cookie';\n\nasync function bootstrap() {\n  const app = await NestFactory.create<NestFastifyApplication>(AppModule, new FastifyAdapter());\n  const logger = new Logger('NestApplication');\n  const env = app.get(EnvService);\n  const port = env.get<number>('PORT') || 3000\n\n  // app.enableCors({\n  //   origin: '*',\n  //   methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',\n  //   preflightContinue: false,\n  //   optionsSuccessStatus: 204,\n  // });\n\n  await app.register(compression);\n  await app.register(cookie, {\n    secret: env.get('COOKIE_SECRET'),\n  });\n\n\n  app.useGlobalPipes(\n    new ValidationPipe({\n      transform: true,\n    }),\n  );\n\n  // Swagger\n  const document = new DocumentBuilder()\n    .setTitle('Questly API')\n    .setDescription('The Questly API description')\n    .setVersion('1.0')\n    .addBearerAuth()\n    .build();\n  const documentSwagger = SwaggerModule.createDocument(app, document);\n  SwaggerModule.setup('docs', app, documentSwagger);\n\n  // Express-like middleware\n  const fastifyInstance = app.getHttpAdapter().getInstance()\n  fastifyInstance\n    .addHook('onRequest', async (req, res) => {\n      req.socket['encrypted'] = env.get('NODE_ENV') === 'production'\n    })\n    .decorateReply('setHeader', function (name: string, value: unknown) {\n      this.header(name, value)\n    })\n    .decorateReply('end', function () {\n      this.send('')\n    })\n\n  await app.listen(port, () => logger.debug(`ðŸš€ App listening on http://localhost:${port}/docs`));\n}\n\nbootstrap();\n"],"names":["bootstrap","app","NestFactory","create","AppModule","FastifyAdapter","logger","Logger","env","get","EnvService","port","register","compression","cookie","secret","useGlobalPipes","ValidationPipe","transform","document","DocumentBuilder","setTitle","setDescription","setVersion","addBearerAuth","build","documentSwagger","SwaggerModule","createDocument","setup","fastifyInstance","getHttpAdapter","getInstance","addHook","req","res","socket","decorateReply","name","value","header","send","listen","debug"],"mappings":";;;;sBAA4B;2BACF;4BACC;wBACY;yBACQ;iCACQ;kEACzB;gEACL;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEzB,eAAeA;IACb,MAAMC,MAAM,MAAMC,iBAAW,CAACC,MAAM,CAAyBC,oBAAS,EAAE,IAAIC,+BAAc;IAC1F,MAAMC,SAAS,IAAIC,cAAM,CAAC;IAC1B,MAAMC,MAAMP,IAAIQ,GAAG,CAACC,sBAAU;IAC9B,MAAMC,OAAOH,IAAIC,GAAG,CAAS,WAAW;IAExC,mBAAmB;IACnB,iBAAiB;IACjB,+CAA+C;IAC/C,8BAA8B;IAC9B,+BAA+B;IAC/B,MAAM;IAEN,MAAMR,IAAIW,QAAQ,CAACC;IACnB,MAAMZ,IAAIW,QAAQ,CAACE,SAAQ;QACzBC,QAAQP,IAAIC,GAAG,CAAC;IAClB;IAGAR,IAAIe,cAAc,CAChB,IAAIC,sBAAc,CAAC;QACjBC,WAAW;IACb;IAGF,UAAU;IACV,MAAMC,WAAW,IAAIC,wBAAe,GACjCC,QAAQ,CAAC,eACTC,cAAc,CAAC,+BACfC,UAAU,CAAC,OACXC,aAAa,GACbC,KAAK;IACR,MAAMC,kBAAkBC,sBAAa,CAACC,cAAc,CAAC3B,KAAKkB;IAC1DQ,sBAAa,CAACE,KAAK,CAAC,QAAQ5B,KAAKyB;IAEjC,0BAA0B;IAC1B,MAAMI,kBAAkB7B,IAAI8B,cAAc,GAAGC,WAAW;IACxDF,gBACGG,OAAO,CAAC,aAAa,OAAOC,KAAKC;QAChCD,IAAIE,MAAM,CAAC,YAAY,GAAG5B,IAAIC,GAAG,CAAC,gBAAgB;IACpD,GACC4B,aAAa,CAAC,aAAa,SAAUC,IAAY,EAAEC,KAAc;QAChE,IAAI,CAACC,MAAM,CAACF,MAAMC;IACpB,GACCF,aAAa,CAAC,OAAO;QACpB,IAAI,CAACI,IAAI,CAAC;IACZ;IAEF,MAAMxC,IAAIyC,MAAM,CAAC/B,MAAM,IAAML,OAAOqC,KAAK,CAAC,CAAC,qCAAqC,EAAEhC,KAAK,KAAK,CAAC;AAC/F;AAEAX"}